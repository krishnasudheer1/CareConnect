{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard | CareConnect</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<link rel="icon" href="https://www.hhaexchange.com/wp-content/uploads/2023/02/CareConnect_LogoRefresh_Final_Stacked_NoTagline-1920x1200.png">


<style>
/* ---------- Existing CSS (as you have) ---------- */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: Inter, system-ui, sans-serif;
}

body {
    display: flex;
    min-height: 100vh;
    background: #f8f9fb;
}

/* SIDEBAR */
.sidebar {
    width: 260px;
    background: #fff;
    border-right: 1px solid #e5e7eb;
    padding: 24px;
}

.logo {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 30px;
}

.menu a {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 14px;
    margin-bottom: 10px;
    text-decoration: none;
    color: #111;
    border-radius: 12px;
    font-size: 14px;
}

.menu a.active,
.menu a:hover {
    background: #eef2ff;
    font-weight: 600;
}

/* MAIN */
.main {
    flex: 1;
    padding: 30px 40px;
}

/* TOPBAR */
.topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.search-container {
    position: relative;
    width: 280px;
}

.search-container input {
    width: 100%;
    padding: 10px 14px 10px 36px;
    border-radius: 10px;
    border: 1px solid #ddd;
}

.search-container i {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #999;
}

/* PROFILE */
.profile-menu {
    position: relative;
}

.profile-avatar {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    background: #111;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    cursor: pointer;
}

.profile-dropdown {
    position: absolute;
    top: 50px;
    right: 0;
    width: 260px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    display: none;
    overflow: hidden;
}

.profile-header {
    padding: 14px 16px;
    border-bottom: 1px solid #e5e7eb;
}

.profile-header small {
    display: block;
    color: #666;
    font-size: 12px;
}

.profile-dropdown a {
    display: block;
    padding: 12px 16px;
    text-decoration: none;
    color: #111;
    font-size: 14px;
}

.profile-dropdown a:hover {
    background: #f1f5f9;
}

/* CONTENT */
h1 {
    margin-bottom: 6px;
}

.welcome {
    color: #666;
    margin-bottom: 25px;
}

.top-action {
    float: right;
    margin-top: -55px;
}

.btn {
    padding: 12px 22px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
}

.btn-blue {
    background: #2563eb;
    color: #fff;
}

.cards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 30px;
}

.card {
    background: #fff;
    border-radius: 16px;
    padding: 22px;
    border: 1px solid #e5e7eb;
}

.card h4 {
    font-size: 14px;
    margin-bottom: 12px;
    color: #555;
}

.card span {
    font-size: 26px;
    font-weight: 700;
}

.empty-box {
    background: #fff;
    border-radius: 18px;
    padding: 50px;
    border: 1px solid #e5e7eb;
    text-align: center;
}

.empty-box p {
    margin: 12px 0 20px;
    color: #666;
}
.logo {
    font-size: 20px;
    font-weight: 700;
}

/* ---------- RESPONSIVE MEDIA QUERIES ---------- */
@media (max-width: 1024px) {
    .sidebar { width: 220px; padding: 20px; }
    .main { padding: 25px 30px; }
}

@media (max-width: 768px) {

    body {
        flex-direction: row; /* KEEP sidebar on the left */
    }

    .sidebar {
        width: 80px;                /* collapsed sidebar */
        padding: 16px 10px;
    }
    .logo-full {
        display: none;
    }

    .logo-short {
        display: block;
        font-size: 18px;
        font-weight: 700;
        text-align: center;
    }


    .menu a {
        justify-content: center;
        padding: 12px 0;
        font-size: 0; 
        flex-direction: column;
        gap: 6px;              /* hide text */
    }

    .menu a i {
        font-size: 18px;            /* icons only */
    }

    .main {
        padding: 20px;
    }
}


@media (max-width: 480px) {
    .main { padding: 15px; }
    .topbar { flex-direction: column; align-items: flex-start; gap: 15px; }
    .search-container { width: 100%; }
    .profile-menu { margin-left: 0; }
    h1 { font-size: 20px; }
    .welcome { font-size: 13px; }
    .cards { gap: 15px; }
    .btn { font-size: 13px; padding: 10px 18px; }
}
</style>
</head>

<body>
<!-- SIDEBAR -->
<aside class="sidebar">
    <div class="logo">CareConnect</div>
    <nav class="menu">
        <a class="active" href="{% url 'Home:dashboard' %}"><i class="fa fa-home"></i>Dashboard</a>
        <a href="{% url 'Appointments:appointment' %}"><i class="fa fa-calendar-plus"></i>Book Appointment</a>
        <a href="{% url 'patient_history' %}"><i class="fa fa-history"></i>History</a>
        <a href="{% url 'accounts:patient_profile' %}"><i class="fa fa-user"></i>Profile</a>
        <a href="#"><i class="fa fa-circle-question"></i>Help</a>
        <a href="{% url 'Home:logout' %}"><i class="fa fa-right-from-bracket"></i>Logout</a>
    </nav>
</aside>

<!-- MAIN -->
<main class="main">
    <!-- TOPBAR -->
    <div class="topbar">
        <div class="search-container">
            <i class="fa fa-search"></i>
            <input type="text" placeholder="Search..." />
        </div>
       {% if messages %}
  <div style="margin-bottom:20px;">
    {% for message in messages %}
      <div
        class="flash-message"
        style="
          padding:14px 18px;
          border-radius:12px;
          margin-bottom:12px;
          font-weight:600;
          background:#d1fae5;
          color:#065f46;
          border:1px solid #6ee7b7;
        ">
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}

        <div class="profile-menu">
            <div class="profile-avatar" onclick="toggleProfile()">
                {{ user.first_name|slice:":1"|upper }}{{ user.last_name|slice:":1"|upper }}
            </div>

            <div class="profile-dropdown" id="profileDropdown">
                <div class="profile-header">
                    <strong>{{ user.get_full_name|upper }}</strong>
                    <small>{{ user.email }}</small>
                </div>
                <a href="{% url 'accounts:patient_profile' %}">Profile</a>
                <a href="{% url 'patient_history' %}">Settings</a>
                <a href="{% url 'Home:logout' %}">Logout</a>
            </div>
        </div>
    </div>

    {% block content %}
    <h1>Dashboard</h1>
    <div class="welcome">Welcome back, {{ user.get_full_name|upper }}</div>

    <a href="{% url 'Appointments:appointment' %}" class="top-action">
        <button class="btn btn-blue">Book New Appointment</button>
    </a>

    <div class="cards">
        <div class="card">
            <h4>Upcoming Appointments</h4>
            <span>{{ upcoming_count }}</span><br>appointments scheduled
        </div>
        <div class="card">
            <h4>Past Appointments</h4>
            <span>{{ past_count }}</span><br>completed or cancelled
        </div>
        <div class="card">
            <h4>Total Bookings</h4>
            <span>{{ total_count }}</span><br>lifetime bookings
        </div>
    </div>

    <div class="empty-box">
        <h3>Welcome to CareConnect!</h3>
        <p>You haven't booked any appointments yet.</p>
        <a href="{% url 'Appointments:appointment' %}">
            <button class="btn" style="background-color: black; color: white;">Book Your First Appointment</button>
        </a>
    </div>


    
    {% endblock %}
</main>

<script>
function toggleProfile() {
    const d = document.getElementById("profileDropdown");
    d.style.display = d.style.display === "block" ? "none" : "block";
}

document.addEventListener("click", e => {
    if (!e.target.closest(".profile-menu")) {
        document.getElementById("profileDropdown").style.display = "none";
    }
});

document.addEventListener("DOMContentLoaded", () => {
    setTimeout(() => {
        document.querySelectorAll(".flash-message").forEach(msg => {
            msg.style.transition = "opacity 0.5s ease, transform 0.5s ease";
            msg.style.opacity = "0";
            msg.style.transform = "translateY(-10px)";
            setTimeout(() => msg.remove(), 500);
        });
    }, 1000); // disappears after 1 second
});
</script>

</body>
</html>